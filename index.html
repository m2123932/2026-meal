<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meal Planner 2026 Weekend-Style</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #d4af37; --bg: #0a0805; --past-text: #5c5248; --today-bg: #1e1a11; --weekend: #ff7e67; }
        body { background: #1a120b; color: var(--gold); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; padding: 10px; text-align: center; }
        
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 500px; margin: 0 auto 15px auto; }
        .nav-btn { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 8px 18px; border-radius: 20px; cursor: pointer; font-size: 13px; letter-spacing: 1px; }
        
        table { width: 100%; max-width: 500px; margin: 0 auto; border-collapse: collapse; background: var(--bg); border: 1px solid var(--gold); }
        tr { border-bottom: 1px solid rgba(212, 175, 55, 0.2); transition: 0.3s; }
        
        /* å·¦å´æ—¥æœŸæ¬„ä½ */
        .date-col { width: 90px; padding: 15px 10px; text-align: left; border-right: 1px solid rgba(212, 175, 55, 0.2); vertical-align: middle; }
        .day-label { font-size: 10px; letter-spacing: 1px; opacity: 0.7; margin-bottom: 3px; display: block; }
        .date-num { font-size: 32px; font-weight: 900; line-height: 0.9; display: block; }
        
        /* å³å´é¤é»æ¬„ä½ */
        .meal-col { padding: 12px 18px; text-align: left; vertical-align: middle; }
        .slot { min-height: 38px; display: flex; align-items: center; border-radius: 4px; margin: 4px 0; cursor: pointer; }
        .lunch { color: #eee6ac; font-size: 17px; }
        .dinner { color: #ffffff; font-size: 17px; }
        
        /* éå»èˆ‡ä»Šæ—¥ */
        .past { opacity: 0.4; }
        .today { background: var(--today-bg); box-shadow: inset 0 0 15px rgba(212, 175, 55, 0.1); }
        .today .date-num { color: #fff; text-shadow: 0 0 8px var(--gold); }

        /* å…­æ—¥ç‰¹åˆ¥é¢¨æ ¼ */
        .weekend-row { background: rgba(255, 126, 103, 0.03); }
        .weekend-row .date-num, .weekend-row .day-label { color: var(--weekend); }
        .weekend-row .date-col { border-right: 1px solid rgba(255, 126, 103, 0.2); }

        /* æ‹–æ›³èˆ‡ç©ºç™½æç¤º */
        .drag-over { background: rgba(212, 175, 55, 0.2) !important; outline: 1px dashed #fff; }
    </style>
</head>
<body>

    <h2 style="letter-spacing: 6px; font-weight: 200; margin: 10px 0; font-size: 1.2rem;">MENU Â· WEEKLY</h2>
    
    <div class="nav">
        <button class="nav-btn" onclick="moveWeek(-7)">PREV</button>
        <span id="rangeDisplay" style="font-weight: bold; font-size: 16px;">Loading...</span>
        <button class="nav-btn" onclick="moveWeek(7)">NEXT</button>
    </div>

    <table id="mealTable"></table>

    <script>
        const config = {
            apiKey: "AIzaSyA3ML8cqPwg6UNpv-uH-KKwppsgKtZ-Hv4",
            authDomain: "mealplanner-972b1.firebaseapp.com",
            databaseURL: "https://mealplanner-972b1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mealplanner-972b1",
            appId: "1:511929578175:web:aa6a2680340e4501690c0a"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let currentMon = new Date();
        let day = currentMon.getDay();
        currentMon.setDate(currentMon.getDate() - (day === 0 ? 6 : day - 1));
        currentMon.setHours(0,0,0,0);

        let dragSource = null;

        function render() {
            const sun = new Date(currentMon); sun.setDate(sun.getDate() + 6);
            document.getElementById('rangeDisplay').innerText = `${currentMon.getMonth()+1}/${currentMon.getDate()} - ${sun.getMonth()+1}/${sun.getDate()}`;
            
            db.ref('meals_v2').on('value', snap => {
                const data = snap.val() || {};
                const table = document.getElementById('mealTable');
                table.innerHTML = "";
                const labels = ["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"];
                const today = new Date(); today.setHours(0,0,0,0);

                for (let i = 0; i < 7; i++) {
                    let d = new Date(currentMon); d.setDate(d.getDate() + i);
                    let key = `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                    let m = data[key] || {};
                    
                    let status = "";
                    if (d < today) status = "past";
                    if (d.getTime() === today.getTime()) status = "today";
                    
                    // åˆ¤å®šæ˜¯å¦ç‚ºé€±æœ« (æ˜ŸæœŸå…­ i=5, æ˜ŸæœŸæ—¥ i=6)
                    let weekendClass = (i >= 5) ? "weekend-row" : "";

                    let row = `<tr class="${status} ${weekendClass}">
                        <td class="date-col">
                            <span class="day-label">${labels[i]}</span>
                            <span class="date-num">${d.getDate()}</span>
                        </td>
                        <td class="meal-col">
                            <div class="slot lunch" draggable="true" 
                                 ondragstart="drag('${key}','lunch','${m.lunch||"-"}')" 
                                 ondragover="e=>e.preventDefault()"
                                 ondragenter="this.classList.add('drag-over')"
                                 ondragleave="this.classList.remove('drag-over')"
                                 ondrop="drop(event,'${key}','lunch')"
                                 onclick="edit('${key}','lunch','${m.lunch||"-"}')">
                                 â˜€ï¸ ${m.lunch || "-"}
                            </div>
                            <div class="slot dinner" draggable="true" 
                                 ondragstart="drag('${key}','dinner','${m.dinner||""}')"
                                 ondragover="e=>e.preventDefault()"
                                 ondragenter="this.classList.add('drag-over')"
                                 ondragleave="this.classList.remove('drag-over')"
                                 ondrop="drop(event,'${key}','dinner')"
                                 onclick="edit('${key}','dinner','${m.dinner||"-"}')">
                                 ğŸŒ™ ${m.dinner || "-"}
                            </div>
                        </td>
                    </tr>`;
                    table.innerHTML += row;
                }
            });
        }

        function drag(k, t, v) { if(v && v !== "-") dragSource = {k, t, v}; }
        function drop(e, toK, toT) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            if(!dragSource) return;
            // å¦‚æœç›®æ¨™åŸæœ¬æ˜¯ "-"ï¼Œå‰‡è¦–ç‚ºè¦†è“‹
            db.ref('meals_v2').child(dragSource.k).child(dragSource.t).remove();
            db.ref('meals_v2').child(toK).update({ [toT]: dragSource.v });
            dragSource = null;
        }

        function edit(k, t, old) {
            let initial = (old === "-") ? "" : old;
            let v = prompt(`ç·¨è¼¯${t==='lunch'?'åˆé¤':'æ™šé¤'}:`, initial);
            if (v !== null) {
                if (v.trim() === "" || v === "-") db.ref('meals_v2').child(k).child(t).remove();
                else db.ref('meals_v2').child(k).update({ [t]: v });
            }
        }

        function moveWeek(n) { currentMon.setDate(currentMon.getDate() + n); render(); }
        render();
    </script>
</body>
</html>
