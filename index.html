<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meal Planner 2026 - Bold Type</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --gold: #c5a059; 
            --gold-light: rgba(197, 160, 89, 0.2);
            --bg: #0f0d0a; 
            --text-main: #e0d5c1;
            --past: #554d44; 
            --weekend: #d9887b; 
        }
        
        body { 
            background: #15120e; 
            color: var(--text-main); 
            font-family: -apple-system, sans-serif; 
            margin: 0; 
            padding: 15px; 
            text-align: center; 
        }
        
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 500px; margin: 0 auto 20px auto; }
        .nav-btn { background: none; border: 1px solid var(--gold-light); color: var(--gold); padding: 6px 16px; border-radius: 15px; cursor: pointer; font-size: 12px; }
        
        table { 
            width: 100%; 
            max-width: 500px; 
            margin: 0 auto; 
            border-collapse: collapse; 
            background: var(--bg); 
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--gold-light);
        }

        tr { border-bottom: 1px solid rgba(197, 160, 89, 0.1); transition: 0.3s; }
        tr:last-child { border-bottom: none; }
        
        /* å·¦å´æ—¥æœŸå€å¡Š - åŠ å¤§å­—é«” */
        .date-col { 
            width: 85px; /* å¢åŠ å¯¬åº¦ä»¥å®¹ç´å¤§å­— */
            padding: 20px 12px; 
            text-align: left; 
            border-right: 1px solid rgba(197, 160, 89, 0.1); 
            vertical-align: middle;
        }

        .day-label { 
            font-size: 13px; /* æ”¾å¤§æ˜ŸæœŸå­—é«” */
            display: block; 
            opacity: 0.7; 
            letter-spacing: 1.5px; 
            margin-bottom: 4px; 
            font-weight: 500;
        }
        .date-num { 
            font-size: 38px; /* é¡¯è‘—æ”¾å¤§æ—¥æœŸæ•¸å­— */
            font-weight: 500; 
            line-height: 0.9; 
            color: var(--gold); 
        }
        
        .meal-col { padding: 12px 18px; text-align: left; vertical-align: middle; }
        
        .slot { 
            min-height: 38px; 
            display: flex; 
            align-items: center; 
            cursor: grab; 
            font-size: 17px; /* ç¨å¾®æ”¾å¤§é¤é»å­—é«” */
            margin: 6px 0;
            padding: 4px 8px;
            border-radius: 6px;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .dragging { opacity: 0.4; background: var(--gold-light); }
        .drag-over { background: rgba(197, 160, 89, 0.15) !important; border: 1px dashed var(--gold); }

        .past { opacity: 0.3; }
        .today { background: rgba(197, 160, 89, 0.08); } 
        .today .date-num { font-weight: 700; text-shadow: 0 0 12px rgba(197, 160, 89, 0.4); }

        .weekend-row { background: rgba(217, 136, 123, 0.02); }
        .weekend-row .date-num, .weekend-row .day-label { color: var(--weekend); }
    </style>
</head>
<body>
    <h3 style="letter-spacing: 5px; margin: 15px 0; font-weight: 300; color: var(--gold); font-size: 1.2rem;">PLANNER</h3>
    
    <div class="nav">
        <button class="nav-btn" onclick="moveWeek(-7)">PREV</button>
        <span id="rangeDisplay" style="font-weight: 400; font-size: 17px; color: var(--gold);">Loading...</span>
        <button class="nav-btn" onclick="moveWeek(7)">NEXT</button>
    </div>
    
    <table id="mealTable"></table>

    <script>
        const config = {
            apiKey: "AIzaSyA3ML8cqPwg6UNpv-uH-KKwppsgKtZ-Hv4",
            authDomain: "mealplanner-972b1.firebaseapp.com",
            databaseURL: "https://mealplanner-972b1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mealplanner-972b1",
            appId: "1:511929578175:web:aa6a2680340e4501690c0a"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let currentMon = new Date();
        let day = currentMon.getDay();
        currentMon.setDate(currentMon.getDate() - (day === 0 ? 6 : day - 1));
        currentMon.setHours(0,0,0,0);
        let dragSource = null;

        function render() {
            const sun = new Date(currentMon); sun.setDate(sun.getDate() + 6);
            document.getElementById('rangeDisplay').innerText = `${currentMon.getMonth()+1}/${currentMon.getDate()} â€” ${sun.getMonth()+1}/${sun.getDate()}`;
            
            db.ref('meals_v2').on('value', snap => {
                const data = snap.val() || {};
                const table = document.getElementById('mealTable');
                table.innerHTML = "";
                const labels = ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"];
                const today = new Date(); today.setHours(0,0,0,0);

                for (let i = 0; i < 7; i++) {
                    let d = new Date(currentMon); d.setDate(d.getDate() + i);
                    let key = `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                    let m = data[key] || {};
                    let isWE = (i >= 5);
                    let status = (d < today) ? "past" : (d.getTime() === today.getTime() ? "today" : "");
                    
                    let lTxt = m.lunch ? 'â˜€ï¸ ' + m.lunch : (isWE ? 'â˜€ï¸ -' : '');
                    let dTxt = m.dinner ? 'ğŸŒ™ ' + m.dinner : (isWE ? 'ğŸŒ™ -' : '');

                    table.innerHTML += `<tr class="${status} ${isWE ? 'weekend-row' : ''}">
                        <td class="date-col">
                            <span class="day-label">${labels[i]}</span>
                            <span class="date-num">${d.getDate()}</span>
                        </td>
                        <td class="meal-col">
                            <div class="slot" draggable="true" 
                                 ondragstart="handleDragStart(event,'${key}','lunch','${m.lunch||""}')" 
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 ondrop="handleDrop(event,'${key}','lunch')"
                                 onclick="edit('${key}','lunch','${m.lunch||""}')">
                                 ${lTxt}
                            </div>
                            <div class="slot" draggable="true" 
                                 ondragstart="handleDragStart(event,'${key}','dinner','${m.dinner||""}')"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 ondrop="handleDrop(event,'${key}','dinner')"
                                 onclick="edit('${key}','dinner','${m.dinner||""}')">
                                 ${dTxt}
                            </div>
                        </td>
                    </tr>`;
                }
            });
        }

        function handleDragStart(e, k, t, v) {
            if(!v || v === "-") { e.preventDefault(); return; }
            dragSource = {k, t, v};
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e, toK, toT) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            if(!dragSource) return;
            if(dragSource.k === toK && dragSource.t === toT) return;
            db.ref('meals_v2').child(dragSource.k).child(dragSource.t).remove();
            db.ref('meals_v2').child(toK).update({ [toT]: dragSource.v });
            dragSource = null;
        }

        function edit(k, t, old) {
            let v = prompt(`ç·¨è¼¯ ${t==='lunch'?'åˆé¤':'æ™šé¤'}:`, old);
            if (v !== null) {
                if (v.trim()==="") db.ref('meals_v2').child(k).child(t).remove();
                else db.ref('meals_v2').child(k).update({ [t]: v });
            }
        }
        function moveWeek(n) { currentMon.setDate(currentMon.getDate()+n); render(); }
        render();
    </script>
</body>
</html>
