<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meal Planner 2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #d4af37; --bg: #0a0805; --past-text: #5c5248; --today-bg: #1e1a11; --weekend: #ff7e67; }
        body { background: #1a120b; color: var(--gold); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; padding: 10px; text-align: center; }
        
        .nav { display: flex; justify-content: space-between; align-items: center; max-width: 500px; margin: 0 auto 15px auto; }
        .nav-btn { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 8px 18px; border-radius: 20px; cursor: pointer; font-size: 13px; }
        
        table { width: 100%; max-width: 500px; margin: 0 auto; border-collapse: collapse; background: var(--bg); border: 1px solid var(--gold); }
        tr { border-bottom: 1px solid rgba(212, 175, 55, 0.2); }
        
        .date-col { width: 90px; padding: 15px 10px; text-align: left; border-right: 1px solid rgba(212, 175, 55, 0.2); vertical-align: middle; }
        .day-label { font-size: 10px; letter-spacing: 1px; opacity: 0.7; margin-bottom: 3px; display: block; }
        .date-num { font-size: 32px; font-weight: 900; line-height: 0.9; display: block; }
        
        .meal-col { padding: 12px 18px; text-align: left; vertical-align: middle; }
        .slot { min-height: 38px; display: flex; align-items: center; border-radius: 4px; margin: 4px 0; cursor: pointer; border: 1px solid transparent; }
        .lunch { color: #eee6ac; font-size: 17px; }
        .dinner { color: #ffffff; font-size: 17px; }
        
        .past { opacity: 0.4; }
        .today { background: var(--today-bg); }
        .today .date-num { color: #fff; text-shadow: 0 0 8px var(--gold); }

        /* 六日樣式 */
        .weekend-row { background: rgba(255, 126, 103, 0.03); }
        .weekend-row .date-num, .weekend-row .day-label { color: var(--weekend); }

        .drag-over { background: rgba(212, 175, 55, 0.15) !important; border: 1px dashed #fff !important; }
    </style>
</head>
<body>

    <h2 style="letter-spacing: 6px; font-weight: 200; margin: 10px 0;">MENU · WEEKLY</h2>
    
    <div class="nav">
        <button class="nav-btn" onclick="moveWeek(-7)">PREV</button>
        <span id="rangeDisplay" style="font-weight: bold;">Loading...</span>
        <button class="nav-btn" onclick="moveWeek(7)">NEXT</button>
    </div>

    <table id="mealTable"></table>

    <script>
        const config = {
            apiKey: "AIzaSyA3ML8cqPwg6UNpv-uH-KKwppsgKtZ-Hv4",
            authDomain: "mealplanner-972b1.firebaseapp.com",
            databaseURL: "https://mealplanner-972b1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mealplanner-972b1",
            appId: "1:511929578175:web:aa6a2680340e4501690c0a"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let currentMon = new Date();
        let day = currentMon.getDay();
        currentMon.setDate(currentMon.getDate() - (day === 0 ? 6 : day - 1));
        currentMon.setHours(0,0,0,0);

        let dragSource = null;

        function render() {
            const sun = new Date(currentMon); sun.setDate(sun.getDate() + 6);
            document.getElementById('rangeDisplay').innerText = `${currentMon.getMonth()+1}/${currentMon.getDate()} - ${sun.getMonth()+1}/${sun.getDate()}`;
            
            db.ref('meals_v2').on('value', snap => {
                const data = snap.val() || {};
                const table = document.getElementById('mealTable');
                table.innerHTML = "";
                const labels = ["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"];
                const today = new Date(); today.setHours(0,0,0,0);

                for (let i = 0; i
